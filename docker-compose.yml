version: '3.8'

services:
  traefik-proxy:
    image: traefik:v2.11
    container_name: proxy
    ports:
      - "80:80"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./conf/traefik.yml:/traefik.yml

  traefik-whoami:
    image: traefik/whoami
    container_name: whoami
    command:
      - --port=3333
    labels:
      - traefik.enable=true
      - traefik.http.routers.whoami.rule=Host(`localhost`) && Path(`/app`)
      - traefik.http.routers.whoami.entrypoints=web
      - traefik.http.services.whoami.loadbalancer.server.port=3333

  http-server:
    image: registry.csc.sibsutis.ru/is042s17/virtualization-technologies:v1.0.0
    container_name: randomizer
    labels:
      - traefik.enable=true
      - traefik.http.routers.randomizer.rule=Host(`localhost`)
      - traefik.http.routers.randomizer.entrypoints=web
      - traefik.http.services.randomizer.loadbalancer.server.port=8080